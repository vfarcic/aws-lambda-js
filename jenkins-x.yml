buildPack: go
pipelineConfig:
  env:
  - name: AWS_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        key: access-key-id
        name: aws-lambda
  - name: AWS_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        key: secret-access-key
        name: aws-lambda
  pipelines:
    overrides:
    - pipeline: release
      stage: build
    - pipeline: release
      stage: promote
      steps:
      - name: changelog
        sh: jx step changelog --version v\$(cat ../../VERSION)
      # TODO: Move to the staging env. repo
      - name: deploy stagin
        sh: serverless deploy --verbose --region us-west-2 --stage dev
        agent:
          image: vfarcic/lambda-nodejs:10
