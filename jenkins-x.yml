buildPack: go
pipelineConfig:
  env:
  - name: AWS_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        key: access-key-id
        name: aws-lambda
  - name: AWS_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        key: secret-access-key
        name: aws-lambda
  pipelines:
    overrides:
    - pipeline: release
      stage: build
    - pipeline: release
      stage: promote
      steps:
      - name: changelog
        sh: jx step changelog --version v\$(cat ../../VERSION)
      # TODO: Move to the stagin env. repo
      - name: deploy
        sh: serverless deploy --verbose --region us-west-1
        agent:
          image: vfarcic/lambda-nodejs:10
      # steps:
      # - name: something 1
      #   sh: echo \$AWS_ACCESS_KEY_ID
      # - name: something 2
      #   sh: echo \$AWS_SECRET_ACCESS_KEY
